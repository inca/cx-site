
<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <link rel="stylesheet" media="screen, projection" href="/css/main.css" />
  <link rel="stylesheet" media="screen, projection" href="/css/colorbox.css" />
  <link rel="stylesheet" href="/css/menu_navigation.css" />
  <link rel="stylesheet" media="print" href="/css/print.css" />
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
  <link rel="icon" href="/favicon.ico" type="image/x-icon"/>
  <meta name="google-site-verification" content="8igpdSJ4tgF2EKKuvmA5GOWzRLKHozE5Aun82c5NQZY" />
  <meta name='yandex-verification' content='443ed98406777aa4' />
  <meta name='yandex-verification' content='59d4a20bb51bbfea' />
  <script type="text/javascript" src="http://www.google-analytics.com/ga.js">
  </script>
  <script src="/js/highlight.pack.js"></script>
  <script src="/js/jquery-1.4.2.min.js"></script>
  <script src="/js/jquery.colorbox-min.js"></script>
  <script src="/js/application.js"></script>
  <script src="/js/menu.js"></script> 
    <title>
        Circumflex &mdash; exquisite taste of Scala development
  </title>
</head>
<body>
<div id="header">
  <div class="wrap">
    <h1>
      <a href="/" title="Home">C&icirc;rcumflex</a>
    </h1>
    <span class="aside">exquisite taste of <a href="http://scala-lang.org">Scala</a> development</span>
  </div>
</div>
<div id="slidemenu" class="slidemenu">
  <ul>
    <li>
      <a href="/products.html">Products</a>
      <ul>
        <li>
          <a href="/products/web/index.html">Web Framework</a>
          <ul>
            <li><a href="/products/web/index.html">About</a></li>
            <li><a href="/products/web/install_config.html">Quick Start</a></li>
            <li><a href="api/2.0/circumflex-web/src/main/scala/package.scala.html">Documentation</a></li>
            <li>
              <a href="#">Download</a>
              <ul>
                <li><a href="https://github.com/inca/circumflex">GitHub</a></li>
                <li><a href="/download?file=web">Package</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li>
          <a href="/products/orm/index.html">ORM</a>
          <ul>
            <li><a href="/products/orm/index.html">About</a></li>
            <li><a href="/products/orm/install_config.html">Quick Start</a></li>
            <li><a href="/api/2.0/circumflex-orm/src/main/scala/package.scala.html">Documentation</a></li>
            <li>
              <a href="#">Download</a>
              <ul>
                <li><a href="https://github.com/inca/circumflex">GitHub</a></li>
                <li><a href="/download?file=orm">Package</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li>
          <a href="/products/ftl/index.html">FreeMarker Helper</a>
          <ul>
            <li><a href="/products/ftl/index.html">About</a></li>
            <li><a href="/products/ftl/qs.html">Quick Start</a></li>
            <li><a href="/api/2.0/circumflex-ftl/src/main/scala/package.scala.html">Documentation</a></li>
            <li>
              <a href="#">Download</a>
              <ul>
                <li><a href="https://github.com/inca/circumflex">GitHub</a></li>
                <li><a href="/download?file=ftl">Package</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li>
          <a href="/products/me/index.html">Markeven</a>
          <ul>
            <li><a href="/products/me/index.html">About</a></li>
            <li><a href="/products/me/syntax.html">Syntax</a></li>
            <li><a href="/products/me">Try it</a></li>
            <li><a href="/products/me/qs.html">Quick Start</a></li>
            <li><a href="/api/2.0/circumflex-markeven/src/main/scala/package.scala.html">Documentation</a></li>
            <li>
              <a href="#">Download</a>
              <ul>
                <li><a href="https://github.com/inca/circumflex">GitHub</a></li>
                <li><a href="/download?file=me">Package</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li>
          <a href="/products/scalate/index.html">Scalate</a>
          <ul>
            <li><a href="/products/scalate/index.html">About</a></li>
            <li><a href="/products/scalate/qs.html">Quick Start</a></li>
            <li><a href="/api/2.0/circumflex-scalate/src/main/scala/package.scala.html">Documentation</a></li>
            <li>
              <a href="#">Download</a>
              <ul>
                <li><a href="https://github.com/inca/circumflex">GitHub</a></li>
                <li><a href="/download?file=scalate">Package</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li>
          <a href="/products/docco/index.html">Docco</a>
          <ul>
            <li><a href="/products/docco/index.html">About</a></li>
            <li><a href="/products/docco/qs.html">Quick Start</a></li>
            <li><a href="/api/2.0/circumflex-docco/src/main/scala/docco.scala.html">Documentation</a></li>
            <li>
              <a href="#">Download</a>
              <ul>
                <li><a href="https://github.com/inca/circumflex">GitHub</a></li>
                <li><a href="/download?file=docco">Package</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li>
          <a href="/plugin.html">Plugin</a>
          <ul>
            <li><a href="/plugin.html">About</a></li>
            <li>
              <a href="#">Download</a>
              <ul>
                <li><a href="https://github.com/inca/circumflex">GitHub</a></li>
                <li><a href="/download?file=cx-plugin">Package</a></li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>
    </li>
    <li>
      <a href="/products/web/index.html" Web>Web</a>
      <ul>
        <li><a href="/products/web/index.html">About</a></li>
        <li><a href="/products/web/install_config.html">Installation & Configuration</a></li>
        <li>
          <a href="/products/web/basic_concepts">Basic concepts</a>
          <ul>
            <li><a href="/products/web/basic_concepts#routers">Request routers</a></li>
            <li><a href="/products/web/basic_concepts#routes">Routes</a></li>
            <li><a href="/products/web/basic_concepts#matchers">Matchers</a></li>
            <li><a href="/products/web/basic_concepts#params">Parameters</a></li>
            <li><a href="/products/web/basic_concepts#static">Serving Static files</a></li>
            <li><a href="/products/web/basic_concepts#redirect-rewrite">Redirecting & Forwarding</a></li>
            <li><a href="/products/web/basic_concepts#errors">Sending Errors</a></li>
            <li><a href="/products/web/basic_concepts#send-file">Sending Files</a></li>
            <li><a href="/products/web/basic_concepts#xhr">Handling AJAX Requests</a></li>
            <li><a href="/products/web/basic_concepts#headers">Accessing Headers</a></li>
            <li><a href="/products/web/basic_concepts#session">Accessing Session</a></li>
            <li><a href="/products/web/basic_concepts#flashes">Flashes</a></li>
          </ul>
        </li>
        <li>
          <a href="/products/web/advanced_concepts.html">Advanced concepts</a>
          <ul>
            <li><a href="/products/web/advanced_concepts.html#adv-matching">Matching</a></li>
            <li><a href="/products/web/advanced_concepts.html#prefix">Router Prefix</a></li>
          </ul>
        </li>
        <li><a href="/products/web/full.html">Full article</a></li>
      </ul>
    </li>
    <li>
      <a href="/products/orm/index.html">ORM</a>
      <ul>
        <li><a href="/products/orm/index">About</a></li>
        <li><a href="/products/orm/install_config.html">Installation & Configuration</a></li>
        <li>
          <a href="/products/orm/ddl/index.html">Data Definition Language</a>
          <ul>
            <li><a href="/products/orm/ddl/central_abstractions">Central Abstractions</a></li>
            <li><a href="/products/orm/ddl/part_1.html">Record & Relations</a></li>
            <li>
              <a href="/products/orm/ddl/part_2.html">More about Fields</a>
              <ul>
                <li><a href="/products/orm/ddl/part_2.html#idgen">Generating Identifiers</a></li>
                <li><a href="/products/orm/ddl/part_2.html#association">Associations</a></li>
                <li><a href="/products/orm/ddl/part_2.html#validation">Validation</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="/products/orm/exporting_schema.html">Exporting Database Schema</a></li>
        <li>
          <a href="/products/orm/querying/index.html">Querying</a>
          <ul>
            <li><a href="/products/orm/querying/select.html">Select Queries</a></li>
            <li><a href="/products/orm/querying/part_1.html">Table Alias and Projections</a></li>
            <li><a href="/products/orm/querying/part_2.html">Predicates</a></li>
            <li><a href="/products/orm/querying/part_3.html">Joins</a></li>
            <li><a href="/products/orm/querying/part_4.html">Ordering, Grouping & Limiting</a></li>
            <li><a href="/products/orm/querying/part_5.html">Union, Intersect & Except</a></li>
            <li><a href="/products/orm/querying/reusing">Reusing Query Objects</a></li>
            <li><a href="/products/orm/querying/part_6.html">Criteria API</a></li>
          </ul>
        </li>
        <li>
          <a href="/products/orm/dml.html">Data Manipulation</a>
          <ul>
            <li><a href="/products/orm/dml.html#iud">Insert, Update & Delete</a></li>
            <li><a href="/products/orm/dml.html#save">Save</a></li>
            <li>
              <a href="/products/orm/dml.html#bulk">Bulk Queries</a>
              <ul>
                <a href="/products/orm/dml.html#insert-select">Insert-Select</a>
                <a href="/products/orm/dml.html#update-delete">Update & Delete</a>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="/products/orm/full.html">Full article</a></li>
      </ul>
    </li>
    <li>
      <a href="/download?file=full">Download</a>
      <ul>
        <li><a href="https://github.com/inca/circumflex">GitHub</a></li>
        <li><a href="/download?file=full">All components</a></li>
        <li><a href="/download?file=web">Web Framework</a></li>
        <li><a href="/download?file=orm">ORM</a></li>
        <li><a href="/download?file=ftl">FreeMarker Helper</a></li>
        <li><a href="/download?file=me">Markeven</a></li>
        <li><a href="/download?file=scalate">Scalate</a></li>
        <li><a href="/download?file=docco">Docco</a></li>
        <li><a href="/download?file=cx-plugin">Plugin</a></li>
      </ul>
    </li>
    <li><a href="/quick_start.html">Quick Start</a></li>
    <li><a href="/api">Documentation</a></li>
  </ul>
  <br style="clear: left"/>
</div><div id="docco-page">
  <h1 id="docco-back">
    <a href="../../../../index.html" title="Back to index">&larr;</a>&nbsp;&nbsp;package.scala
  </h1>
  <table cellspacing="0" cellpadding="0">
    <tbody>
      <tr id="section-0">
        <td class="docs">
          
        </td>
        <td class="code">
          <pre class="scala"><code>package ru.circumflex

import java.io._
import java.util.Random
import java.util.regex.Pattern
import collection.mutable.HashMap
import core._
import markeven._</code></pre>
        </td>
      </tr>
      <tr id="section-1">
        <td class="docs">
          <h1>The <code>markeven</code> Package</h1>
<p>Package <code>markeven</code> contains a rendering method for Markeven Processor as well as utility methods and constants used under the hood.</p>
<p>You should import this package to use Circumflex Markeven in your application:</p>
<pre><code>import ru.circumflex.markeven._</code></pre>
<h1>Rendering methods</h1>
<p>The <code>toHtml</code> method is used to perform text-to-html conversion using default <code>MarkevenProcessor</code>. The usage is pretty simple:</p>
<pre class="scala"><code>val text = """
Hello world!              {#hi.greeting.example}
============

This is a test.
"""
val html = toHtml(text)</code></pre>
<p>The example above yields following HTML:</p>
<pre class="html"><code>&lt;h1 id="hi" class="greeting example"&gt;Hello world!&lt;/h1&gt;
&lt;p&gt;This is a test.&lt;/p&gt;</code></pre>
<p>You can also use handy <code>renderToFile</code> method, which renders the contents of specified <code>src</code> file into specified <code>dst</code> file:</p>
<pre><code>val src = new File("/path/to/my/text/file.txt")
val dst = new File("/path/to/my/text/file.txt.html")
markeven.renderToFile(src, dst)</code></pre>
<p>It also performs last modified timestamps checking to avoid unnecessary transformation, allowing effective caching of static content. If you do not need this caching behavior, set the <code>force</code> parameter to <code>true</code>:</p>
<pre><code>markeven.renderToFile(src, dst, true)</code></pre>
<p>You can use your custom <code>MarkevenProcessor</code> implementation with rendering methods: just set the <code>markeven.processor</code> configuration parameter to fully-qualified name of your processor implementation.</p>

        </td>
        <td class="code">
          <pre class="scala"><code>package object markeven {

  // Rendering stuff

  def processor = cx.instantiate[MarkevenProcessor](&quot;markeven.processor&quot;, new MarkevenProcessor)

  def toHtml(source: CharSequence): String =
    processor.toHtml(source)

  def renderToFile(src: File, dst: File, force: Boolean = false): Unit =
    processor.renderToFile(src, dst, force)

  // Utilities

  val chars = &quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;
  val keySize = 20
  val rnd = new Random

  val escapeMap = Map[String, String](
    &quot;\\\\&quot; -&gt; &quot;&amp;#92;&quot;,
    &quot;\\`&quot; -&gt; &quot;&amp;#96;&quot;,
    &quot;\\_&quot; -&gt; &quot;&amp;#95;&quot;,
    &quot;\\*&quot; -&gt; &quot;&amp;#42;&quot;,
    &quot;\\{&quot; -&gt; &quot;&amp;#123;&quot;,
    &quot;\\}&quot; -&gt; &quot;&amp;#125;&quot;,
    &quot;\\[&quot; -&gt; &quot;&amp;#91;&quot;,
    &quot;\\]&quot; -&gt; &quot;&amp;#93;&quot;,
    &quot;\\(&quot; -&gt; &quot;&amp;#40;&quot;,
    &quot;\\)&quot; -&gt; &quot;&amp;#41;&quot;,
    &quot;\\#&quot; -&gt; &quot;&amp;#35;&quot;,
    &quot;\\+&quot; -&gt; &quot;&amp;#43;&quot;,
    &quot;\\-&quot; -&gt; &quot;&amp;#45;&quot;,
    &quot;\\~&quot; -&gt; &quot;&amp;#126;&quot;,
    &quot;\\.&quot; -&gt; &quot;&amp;#46;&quot;,
    &quot;\\!&quot; -&gt; &quot;&amp;#33;&quot;)

  object regexes {
    val lineEnds = Pattern.compile(&quot;\\r\\n|\\r&quot;)
    val blankLines = Pattern.compile(&quot;^ +$&quot;, Pattern.MULTILINE)
    val blocks = Pattern.compile(&quot;\\n{2,}&quot;)
    val lines = Pattern.compile(&quot;\\n&quot;)
    val htmlNameExpr = &quot;(?&gt;[a-z][a-z0-9\\-_:.]*+\\b)&quot;
    val inlineHtmlBlockStart = Pattern.compile(&quot;^ {0,3}&lt;(&quot; + htmlNameExpr + &quot;)[\\S\\s]*?(/)?&gt;&quot;,
      Pattern.CASE_INSENSITIVE | Pattern.MULTILINE)
    val inlineHtmlSpanStart = Pattern.compile(&quot;&lt;(&quot; + htmlNameExpr + &quot;)[\\S\\s]*?(/)?&gt;&quot;,
      Pattern.MULTILINE | Pattern.CASE_INSENSITIVE)
    val linkDefinition = Pattern.compile(&quot;^ {0,3}\\[(.+?)\\]: *(\\S.*?)&quot; +
        &quot;(\\n? *\&quot;(.+?)\&quot;)?(?=\\n+|\\Z)&quot;, Pattern.MULTILINE)
    val blockSelector = Pattern.compile(&quot; *+\\{(\\#[a-z0-9_-]+)?((?:\\.[a-z0-9_-]+)+)?\\}$&quot;,
      Pattern.CASE_INSENSITIVE | Pattern.MULTILINE)
    val tableCellSplit = Pattern.compile(&quot;\\|&quot;)
    val tableSeparatorLine = Pattern.compile(&quot;^[- :|]+$&quot;)
    val macro = Pattern.compile(&quot;\\[\\[((?&gt;[a-zA-Z0-9_-]+:))?(.*?)\\]\\]&quot;, Pattern.DOTALL)
    val codeSpan = Pattern.compile(&quot;(`++)(.+?)\\1&quot;)
    val protectKey = Pattern.compile(&quot;!\\}[0-9a-zA-Z]{&quot; + keySize + &quot;}&quot;)
    val backslashChar = Pattern.compile(&quot;\\\\(\\S)&quot;)
    val refLinks = Pattern.compile(&quot;\\[([^\\[\\]]++)\\]\\[([^\\[\\]]*+)\\]&quot;)
    val inlineLinks = Pattern.compile(&quot;\\[([^\\[\\]]++)\\]\\((.*?)( +\&quot;(.*?)\&quot;)?\\)&quot;)
    val htmlComment = Pattern.compile(&quot;^ {0,3}&lt;!--.*?--&gt;\\s*?(?=\\n+|\\Z)&quot;, Pattern.MULTILINE | Pattern.DOTALL)
    val spanEnhancements = Pattern.compile(&quot;([*_~])(?=\\S)(.+?)(?&lt;=\\S)\\1&quot;)

    // escape patterns

    val e_amp = Pattern.compile(&quot;&amp;(?!#?[xX]?[0-9a-zA-Z]+;)&quot;)
    val e_lt = Pattern.compile(&quot;&lt;(?![a-z/?\\$!])&quot;)

    // deterministic patterns

    val d_code = Pattern.compile(&quot;(?: {4,}.*\\n?)+&quot;)
    val d_div = Pattern.compile(&quot;(?: {0,3}\\|.*\\n?)+&quot;)
    val d_blockquote = Pattern.compile(&quot;(?: {0,3}&gt;.*\\n?)+&quot;)
    val d_hr = Pattern.compile(&quot;^-{3,} *\\n?$&quot;)
    val d_table = Pattern.compile(&quot;^-{3,}&gt;?\\n.+\\n *-{3,}\\n?$&quot;, Pattern.DOTALL)
    val d_heading = Pattern.compile(&quot;^(\\#{1,6}) (.*) *\\#*$&quot;, Pattern.DOTALL)
    val d_h1 = Pattern.compile(&quot;^(.+)\\n=+\\n?$&quot;, Pattern.DOTALL)
    val d_h2 = Pattern.compile(&quot;^(.+)\\n-+\\n?$&quot;, Pattern.DOTALL)

    // trimming patterns

    val t_blockquote = Pattern.compile(&quot;^ *&gt;&quot;, Pattern.MULTILINE)
    val t_div = Pattern.compile(&quot;^ *\\|&quot;, Pattern.MULTILINE)
    val t_ul = Pattern.compile(&quot;^(\\* +)&quot;)
    val t_ol = Pattern.compile(&quot;^(\\d+\\. +)&quot;)
    val t_tr = Pattern.compile(&quot;^\\|&quot;)

    // list split patterns

    val s_ul = Pattern.compile(&quot;\\n+(?=\\* )&quot;)
    val s_ol = Pattern.compile(&quot;\\n+(?=\\d+\\. )&quot;)

    // cache dynamic expressions

    protected val outdentMap = new HashMap[Int, Pattern]
    protected val placeholder = Pattern.compile(&quot;^&quot;, Pattern.MULTILINE)

    def outdent(level: Int): Pattern = outdentMap.get(level) match {
      case Some(p) =&gt; p
      case _ =&gt;
        val p = Pattern.compile(&quot;^ {0,&quot; + level + &quot;}&quot;, Pattern.MULTILINE)
        outdentMap += (level -&gt; p)
        p
    }

    protected val htmlTagMap = new HashMap[String, Pattern]

    protected def htmlTagInternal(tag: String): Pattern = htmlTagMap.get(tag) match {
      case Some(p) =&gt; p
      case _ =&gt;
        val p = Pattern.compile(&quot;(&lt;&quot; + tag + &quot;\\b.*?(/)?&gt;)|(&lt;/&quot; + tag + &quot;\\s*&gt;)&quot;,
          Pattern.CASE_INSENSITIVE)
        htmlTagMap += tag -&gt; p
        p
    }

    def htmlTag(tag: String): Pattern = htmlTagInternal(tag.toLowerCase)

    // typographic patterns

    val ty_dash = Pattern.compile(&quot;--&quot;)
    val ty_larr = Pattern.compile(&quot;&amp;lt;-|&lt;-&quot;)
    val ty_rarr = Pattern.compile(&quot;-&amp;gt;|-&gt;&quot;)
    val ty_hellip = Pattern.compile(&quot;\\.{3}&quot;)
    val ty_trade = Pattern.compile(&quot;\\([tT][mM]\\)&quot;)
    val ty_reg = Pattern.compile(&quot;\\([rR]\\)&quot;)
    val ty_copy = Pattern.compile(&quot;\\([cC]\\)&quot;)
    val ty_ldquo = Pattern.compile(&quot;(?&lt;=\\s|\\A)(?:\&quot;|&amp;quot;)(?=\\S)&quot;)
    val ty_rdquo = Pattern.compile(&quot;(?&lt;=[\\p{L})?!.])(?:\&quot;|&amp;quot;)(?=[.,;?!*)]|\\s|\\Z)&quot;)
  }

  object typographics {
    val dash = cx.get(&quot;me.dash&quot;).map(_.toString).getOrElse(&quot;&amp;mdash;&quot;)
    val larr = cx.get(&quot;me.larr&quot;).map(_.toString).getOrElse(&quot;&amp;larr;&quot;)
    val rarr = cx.get(&quot;me.rarr&quot;).map(_.toString).getOrElse(&quot;&amp;rarr;&quot;)
    val hellip = cx.get(&quot;me.hellip&quot;).map(_.toString).getOrElse(&quot;&amp;hellip;&quot;)
    val trade = cx.get(&quot;me.trade&quot;).map(_.toString).getOrElse(&quot;&amp;trade;&quot;)
    val reg = cx.get(&quot;me.reg&quot;).map(_.toString).getOrElse(&quot;&amp;reg;&quot;)
    val copy = cx.get(&quot;me.copy&quot;).map(_.toString).getOrElse(&quot;&amp;copy;&quot;)
    val ldquo = cx.get(&quot;me.ldquo&quot;).map(_.toString).getOrElse(&quot;&amp;ldquo;&quot;)
    val rdquo = cx.get(&quot;me.rdquo&quot;).map(_.toString).getOrElse(&quot;&amp;rdquo;&quot;)
  }
}</code></pre>
        </td>
      </tr>
  </table>
</div>

<div id="footer">
  <p><span>Copyright 2009-2010 <a href="http://circumflex.ru">circumflex.ru</a></span></p>
  <p><a href="/license.html">Terms <span class="amp">&amp;</span> conditions</a> apply &bull;
    <a href="/credits.html">credits</a></p>
</div>
<script type="text/javascript">
  try {
    var pageTracker = _gat._getTracker("UA-12034468-1");
    pageTracker._setDomainName(".circumflex.ru");
    pageTracker._trackPageview();
  } catch(err) {}</script>
</body>
</html>

